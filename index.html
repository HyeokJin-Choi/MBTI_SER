<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI 설문조사</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="mbti-title">
            <h1>MBTI 테스트 🕵️‍♂️</h1>
            <h1> </h1>
        </div>
        <div class="mbti-description">
            <p>👉 몇 가지 질문을 통해 당신의 엠비티아이를 맞춰볼게요! 👈</p>
            <p1>(최근 3개월 이내에 엠비티아이 검사를 진행한 사람일수록 저희의 사이트는 더 정확할 거예요!)</p1>
        </div>
        <div class="start-button">
            <button id="startButton">시작하기☑️</button>
        </div>

        <div id="question-container" class="hidden">
            <!-- 문제 그룹 1 -->
            <div class="question-group">
                <h2>Q1.당신의 음식점 취향이 궁금합니다! 🍜<span id="userCoice"></span></h2>
                <div class="question-container">
                    <p class="question"><h3>1. 밖을 나갔다가 밥을 먹고 집을 갈려고 한다. 당신의 선택은?</h3>
                    <label><input type="radio" name="q1" value="E"> 근처 친구를 불러서 친구랑 밥을 먹는다.</label></p>
                    <label><input type="radio" name="q1" value="I"> 혼자서 음식점에 가서 편안하게 밥을 먹는다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>2. 내가 자주 먹었던 음식점 옆에 새로운 음식점이 생겼다. 당신의 선택은?</h3>
                    <label><input type="radio" name="q2" value="N"> "오! 새로운 음식점이네? 궁금하다." 메뉴도 맛있어 보여서 당장 들어간다.</label></p>
                    <label><input type="radio" name="q2" value="S"> "에이 그래도 자주 먹었던 데가 맛있지" 원래 음식점에 들어간다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>3. 새로운 음식점에 들어와서 메뉴를 고를려고 한다. 당신의 선택은?</h3>
                    <label><input type="radio" name="q3" value="S"> 음식의 실제 맛과 재료에 기반하여 세부적인 선택을 합니다.</label></p>
                    <label><input type="radio" name="q3" value="N"> 음식의 다양한 조합과 특별한 음식 경험을 추구합니다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>4. 자주갔던 음식점에서 메뉴를 보는데 새로운 메뉴가 나왔다! 당신의 선택은?</h3>
                    <label><input type="radio" name="q4" value="S"> "맛없으면 어떡하지?.." 그냥 자주 먹던 메뉴를 시킨다.</label></p>
                    <label><input type="radio" name="q4" value="N"> "오! 맛있겠는데?" 당장 시킨다</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>5. 내일 친구랑 밖에서 밥을 먹을려고한다! 당신의 선택은?</h3>
                    <label><input type="radio" name="q5" value="T"> 음식점의 가격이랑 맛의 리뷰를 보고 신중히 고른다.</label></p>
                    <label><input type="radio" name="q5" value="F"> 음식점의 인테리어가 이쁘고 음식이 맛있어 보이는 데로 고른다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>6. 친구가 돈까스를 먹자했는데, 나는 떡볶이가 먹고싶다. 당신의 대답은?</h3>
                    <label><input type="radio" name="q6" value="T"> "나는 떡볶이 먹고싶어! 떡볶이 어때?"</label></p>
                    <label><input type="radio" name="q6" value="F"> "그래! 돈까스 먹으러 가자"</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>7. 내일 친구랑 양식집을 가기로 했다! 당신의 생각은?</h3>
                    <label><input type="radio" name="q7" value="J"> "친구랑 가니깐 파스타 하나랑, 리조또 하나면 되겠지?"</label></p>
                    <label><input type="radio" name="q7" value="P"> "아 뭐먹지? 내일 가서 메뉴 보고 먹고싶은거 시켜야겠다."</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>8. 주변 사람들과 함께 음식을 나누거나 공유하는 것에 대해서</h3>
                    <label><input type="radio" name="q8" value="J"> 개인적인 식사를 좋아하며, 주변 사람들과 음식을 나누는 것보다 자신의 음식을 즐긴다.</label></p>
                    <label><input type="radio" name="q8" value="P"> 주변 사람들과 음식을 나누고 공유하는 것을 즐긴다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>9.여행을 와서 음식점에서 밥을 먹고 다음 일정을 할려면 달려가야한다. 당신의 선택은?</h3>
                    <label><input type="radio" name="q26" value="E"> 주문 후 빨리 식사를 마치고 다음 일정을 하러 달려간다.</label></p>
                    <label><input type="radio" name="q26" value="I"> 조금 늦어도 되는 일정이니깐 천천히 즐기면서 먹고 걸어간다.</label>
                </div>
                <button id="nextButton" onclick="nextQuestion()">다음</button>
            </div>
        
            <!-- 문제 그룹 2 -->
            <div class="question-group hidden">
                <h2>Q2.당신의 술집 취향이 궁금합니다! 🍺</h2>
                <div class="question-container">
                    <p class="question"><h3>1. 술집을 갈때, 당신이 좋아하는 분위기는?</h3>
                    <label><input type="radio" name="q10" value="E"> 사람들과 함께 놀면서 즐기는 분위기</label></p>
                    <label><input type="radio" name="q10" value="I"> 조용하고 편안한 분위기</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>2. 술집에서 음식이랑 술을 시킬때, 당신의 선택은?</h3>
                    <label><input type="radio" name="q11" value="S"> 음식과 술의 맛이랑 가격보고 신중하게 시킨다.</label></p>
                    <label><input type="radio" name="q11" value="N"> 맛있어 보이는 음식과 새로운 술을 시도 해본다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>3. 너무 심심한 찰나에, 친구가 자기 친구랑 술을 마시고 있다고 나오라고 한다. 당신의 대답은?</h3>
                    <label><input type="radio" name="q12" value="E"> "오 좋은데? 지금 어디야? 거기로 갈게"</label></p>
                    <label><input type="radio" name="q12" value="I"> "아..나 지금 밖에 못나가 미안해 ㅜㅜ"</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>4. 술집에서 친구들과 함께 시간을 보낼 때, 친구가 갑자기 고민 이야기를 한다. 당신의 대답은?</h3>
                    <label><input type="radio" name="q13" value="T"> 친구의 고민을 해결해주면서 빨리 술로 잊어버리자고 한다.</label></p>
                    <label><input type="radio" name="q13" value="F"> 친구를 달래주면서 공감해주고 같이 짠해준다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>5. 친구랑 인기 있는 술집을 가기로 했다. 당신의 선택은?</h3>
                    <label><input type="radio" name="q14" value="J"> 미리 생각하고 정한 음식이랑 술 주문하기</label></p>
                    <label><input type="radio" name="q14" value="P"> 현장에서 직원이 추천해준 음식이랑 술 주문하기</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>6. 친구들이랑 6시에 술집을 가기로하고, 노래방에 있는데 너무 재밌다. 당신의 선택은?</h3>
                    <label><input type="radio" name="q15" value="J"> 6시까지 노래방에 있다가 6시에 술집에 간다.</label></p>
                    <label><input type="radio" name="q15" value="P"> 술집을 늦게 가더라도 노래방 다 즐기고 간다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>7. 술집에서 주로 당신이 마시는 스타일은?</h3>
                    <label><input type="radio" name="q16" value="S"> 술을 마시면서 다른 사람들과 활발한 대화를 즐긴다</label></p>
                    <label><input type="radio" name="q16" value="N"> 술집에서도 조용하게 분위기를 즐기며 생각에 잠기는 시간을 좋아한다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>8. 친구들과 함께 술집에서 이야기를 할때</h3>
                    <label><input type="radio" name="q17" value="T"> 친구들과의 사회적인 교류와 활발한 분위기를 즐기면서 대화한다.</label></p>
                    <label><input type="radio" name="q17" value="F"> 친구들과 깊은 대화를 하며 서로 감정을 공유하면서 대화한다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>9. 술집에서 친구들이랑 새벽까지 마시고 있다. 당신의 상태는?</h3>
                    <label><input type="radio" name="q18" value="E"> "애들아 너무 재밌다 빨리 짠하자 짠!"</label></p>
                    <label><input type="radio" name="q18" value="I"> "기 다 빨려서 집 가고싶다.."</label>
                </div>
                <button id="nextButton" onclick="nextQuestion()">다음</button>
            </div>
    
            <!-- 문제 그룹 3 -->
            <div class="question-group hidden">
                <h2>Q3.당신의 여행지 취향이 궁금합니다! ✈️</h2>
                <div class="question-container">
                    <p class="question"><h3>1. 여행을 할 때, 당신이 선호하는 스타일은?</h3>
                    <label><input type="radio" name="q19" value="E"> 친구나 가족과 함께 활동적으로 여행하는 것을 선호한다.</label></p>
                    <label><input type="radio" name="q19" value="I"> 혼자 혹은 소수의 친한 친구와 조용하고 소규모로 여행하는 것을 더 좋아한다.</label>
                </div>
                
                <div class="question-container">
                    <p class="question"><h3>2. 여행지를 선택할 때, 당신이 선택하는 기준은?</h3>
                    <label><input type="radio" name="q20" value="S"> 구체적인 사실과 경험에 기반하여 선택한다.</label></p>
                    <label><input type="radio" name="q20" value="N"> 감각적인 이미지나 기대감에 기반하여 선택한다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>3. 여행지에서 당신이 좋아하는 활동은?</h3>
                    <label><input type="radio" name="q21" value="E"> 다른 사람들과 함께 활동하며 여행지를 즐기는걸 좋아한다.</label></p>
                    <label><input type="radio" name="q21" value="I"> 조용하게 자연 속에 머무르고 휴식을 취하는 것을 더 좋아한다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>4. 당신이 보통 좋아하고 가보고 싶은 여행지는?</h3>
                    <label><input type="radio" name="q22" value="T"> 문화적인 요소나 역사적인 관광지를 방문하고 싶다.</label></p>
                    <label><input type="radio" name="q22" value="F"> 감성적이고 감정적인 요소가 담긴 자연 경관을 감상하고 싶다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>5. 당신이 여행을 할 때, 여행을 하는 스타일은?</h3>
                    <label><input type="radio" name="q23" value="J"> 미리 계획을 세워 일정을 따라가며 여행을 한다.</label></p>
                    <label><input type="radio" name="q23" value="P"> 상황에 따라 유연하게 계획을 변경하며 여행을 한다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>6. 당신이 친구랑 여행을 가기로 했다. 당신이 여행을 계획할 때</h3>
                    <label><input type="radio" name="q24" value="J"> 계획대로 진행하며 일정에 맞추어 여행을 해야 한다.</label></p>
                    <label><input type="radio" name="q24" value="P"> 계획을 소통하면서 변경하거나 즉흥적으로 여행 일정을 조정하는 것도 재밌어 보인다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>7. 당신이 친구들과 여행을 할 때, 좋아하는 교통수단은 ?</h3>
                    <label><input type="radio" name="q25" value="E"> 여행 동안 다른 사람들과 함께 교통수단을 이용하는 것도 좋다고 생각한다.</label></p>
                    <label><input type="radio" name="q25" value="I"> 혼자 혹은 소수의 친한 친구와 함께 조용하고 편안한 교통수단을 이용하는 것을 더 좋아한다.</label>
                </div>
                
                <div class="question-container">
                    <p class="question"><h3>8. 당신이 좋아하는 관광지는?</h3>
                    <label><input type="radio" name="q26" value="S"> 역사적인 관광지나 문화적인 요소가 담긴 곳을 좋아한다.</label></p>
                    <label><input type="radio" name="q26" value="N"> 자연 경관이 아름답고 창의적인 장소를 좋아한다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>9. 친구랑 여행을 계획할 때, 선호하는 숙소 스타일은?</h3>
                    <label><input type="radio" name="q27" value="T"> 기능적이고 편리한 시설과 서비스를 제공하는 호텔을 선호한다.</label></p>
                    <label><input type="radio" name="q27" value="F"> 감성적이고 독특한 분위기를 갖춘 숙박 시설을 더 선호한다.</label>
                </div>
    
                <div class="question-container">
                    <p class="question"><h3>10. 당신이 보통 여행을 관광하는 스타일은?</h3>
                    <label><input type="radio" name="q28" value="J"> 이왕 간 김에 계획했던 관광지를 다 가보고 즐긴다.</label></p>
                    <label><input type="radio" name="q28" value="P"> 자유롭게 돌아다니며 우연히 발견하는 장소와 경험을 즐긴다.</label>
                </div>
                <button id="nextButton" onclick="nextQuestion()">다음</button>
            </div>
        </div>

    
    <div id="result" class="hidden">
        <h2>당신의 MBTI 유형은 <span id="mbtiResult"></span>입니다!</h2>
        <div class="button-container">
            <button id="matchBtn">맞아요</button>
            <button id="notMatchBtn">아니요</button>
        </div>
    </div>

    <div id="mbtiInput" class="hidden">
        <h3>당신의 MBTI는 무엇인가요?</h3>
        <input type="text" id="mbtiInputField" placeholder="예: INFP" />
        <button id="mbtiConfirmBtn">확인</button>
    </div>

    <script>
        // 추가된 부분: 시작 버튼을 클릭하면 초기화면을 띄우도록 설정
        const startButton = document.getElementById('startButton');
        const questionContainer = document.getElementById('question-container');
        const resultContainer = document.getElementById("result");
        const mbtiTitle = document.querySelector(".mbti-title");
        const mbtiDescription = document.querySelector(".mbti-description");
        const mbtiInputContainer = document.getElementById("mbtiInput");
        const mbtiInputField = document.getElementById("mbtiInputField");
        const mbtiConfirmBtn = document.getElementById("mbtiConfirmBtn");

        const matchBtn = document.getElementById("matchBtn");
        const notMatchBtn = document.getElementById("notMatchBtn");

        startButton.addEventListener('click', () => {
            startButton.style.display = 'none'; // 시작 버튼 숨기기
            mbtiTitle.style.display = "none";
            mbtiDescription.style.display = "none";
            questionContainer.classList.remove('hidden'); // 문제 그룹 컨테이너 보이기
            groups[0].classList.remove('hidden'); // 문제 그룹 1 보이기
        });

        matchBtn.addEventListener("click", () => {
            const selectedMBTI = document.getElementById("mbtiResult").textContent;
            const userInputMBTI = document.getElementById("mbtiResult").textContent;

            sendMBTIValueToServer(selectedMBTI, userInputMBTI);
            
            alert("설문에 응해주셔서 감사합니다!");
        });

        notMatchBtn.addEventListener("click", () => {
            resultContainer.classList.add("hidden");
            mbtiInputContainer.classList.remove("hidden");
        });

        mbtiConfirmBtn.addEventListener("click", () => {
            const selectedMBTI = document.getElementById("mbtiResult").textContent;
            const userInputMBTI = mbtiInputField.value;

            sendMBTIValueToServer(selectedMBTI, userInputMBTI);

            const mbtiPattern = /^[ie][ns][ft][jp]$/i;
            if (!mbtiPattern.test(userInputMBTI)) {
                alert("올바른 MBTI 형식으로 입력해주세요 (예: INFP).");
                return;
            }
            
            alert("설문에 응해주셔서 감사합니다!");
        });


        let currentGroupIndex = 0;
        const groups = document.querySelectorAll('.question-group');
        const answers = {
            'E': 0,
            'I': 0,
            'S': 0,
            'N': 0,
            'T': 0,
            'F': 0,
            'J': 0,
            'P': 0
        };

        function nextQuestion() {
            const currentGroup = groups[currentGroupIndex];
            const selectedRadios = currentGroup.querySelectorAll('input[type="radio"]:checked');
            const requiredCount = (currentGroupIndex === groups.length - 1) ? 10 : 9; // 마지막 블록이면 10, 그 외에는 9

            if (selectedRadios.length >= requiredCount) {
                selectedRadios.forEach(radio => {
                    answers[radio.value]++;
                });

                currentGroup.classList.add('hidden');
                currentGroupIndex++;

                if (currentGroupIndex < groups.length) {
                    groups[currentGroupIndex].classList.remove('hidden');
                } else {
                    showMBTIResult();
                }
            } else {
                alert('모든 문제에 답해주세요!');
            }
        }

        function showMBTIResult() {
            let mbtiResult = '';

            // E와 I의 갯수를 비교하여 저장
            mbtiResult += (answers['E'] > answers['I']) ? 'E' : 'I';

            // S와 N의 갯수를 비교하여 저장
            mbtiResult += (answers['S'] > answers['N']) ? 'S' : 'N';

            // T와 F의 갯수를 비교하여 저장
            mbtiResult += (answers['T'] > answers['F']) ? 'T' : 'F';

            // J와 P의 갯수를 비교하여 저장
            mbtiResult += (answers['J'] > answers['P']) ? 'J' : 'P';

            const resultContainer = document.getElementById('result');
            const mbtiResultElement = document.getElementById('mbtiResult');
            mbtiResultElement.textContent = mbtiResult;
            resultContainer.classList.remove('hidden');
        }

        function sendMBTIValueToServer(selectedMBTI, userInputMBTI) {
            fetch('/save-mbti', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ selectedMBTI: selectedMBTI, userInputMBTI: userInputMBTI })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message); // 서버 응답 메시지
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

    </script>
</body>

</html>
